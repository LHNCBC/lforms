<!doctype html>
<html>
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-75410768-5"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-75410768-5');
    </script>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>LHC-Forms: A Form-Rendering Wigdet</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-dark.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <style>
      /* CSS for adding the version column */
      #versionList {
        float: left;
        margin-left: 1em;
        margin-right: 1em;
        margin-top: 10em;
      }
      #versionList p {
        margin: 0;
      }
      @media screen and (max-width: 1125px) {
        #versionList {
          margin-top: 15em;
        }
        .wrapper {
          float: left;
        }
      }
      @media screen and (max-width: 970px) {
        #versionList {
          width: 100%;
          margin-top: 5em;
        }
        .wrapper {
          float: left;
        }
        section {
          padding-top: 0;
          margin-top: 0;
        }
      }
    </style>
  </head>
  <body>
    <div id=versionList>
      <p>Documentation by version:</p>
      <ul>
        <li>Current (>=13.x)</li>
        <li><a href="versions/11.x/index.html">11-12</a></li>
        <li><a href="versions/7.x/index.html">7-10</a></li>
        <li><a href="versions/6.x/index.html">6.x</a></li>
        <li><a href="versions/5.5/index.html">5.5</a></li>
      </ul>
    </div>

    <div class="wrapper">
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/lhncbc/lforms">View On GitHub</a></li>
          <li class="fork" style="padding-left: 2em"><a href="demos.html">Demos</a></li>
          <li class="downloads"><a href="https://github.com/lhncbc/lforms/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/lhncbc/lforms/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>

      </div><!-- end header -->

      <section>
        <div id="title">
          <h1>LHC-Forms</h1>
          <p>A widget for rendering feature-rich forms defined in JSON definition files</p>
          <hr>
        </div>
        <h2><a id="what-is-lforms" class="anchor" href="#what-is-lforms"
          aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"
          ></span></a>What is LHC-Forms?</h2>

<p><a href="https://lhncbc.nlm.nih.gov/project/lhc-forms">LHC-Forms</a> (a.k.a.
LForms) is a
feature-rich, open-source widget that creates input forms based on definition
files for Web-based applications. It was developed by the Lister Hill National
Center for Biomedical
Communications (<a href="https://lhncbc.nlm.nih.gov">LHNCBC</a>), National Library of
Medicine (<a href="https://www.nlm.nih.gov">NLM</a>),  part of the National Institutes of
Health (<a href="https://www.nih.gov">NIH</a>), with the collaboration and support from the
<a href="https://www.regenstrief.org/">Regenstrief Institute</a>, Inc. and the
<a href="https://loinc.org/">LOINC</a> Committee.</p>

<h2>Features</h2>
See the <a href="demos.html">demos</a> for a step-by-step introduction.
Features include:
<ul>
  <li>Form definitions are defined in JSON, listing the questions</li>
  <li>Sections containing questions</li>
  <li>Repeating sections and questions (by specifying cardinality)</li>
  <li>Hiding and showing questions via skip logic based on the user's answers to
other questions</li>
  <li>Scores for answers which update a total score field.</li>
  <li>Coded answer lists which might require a matching input</li>
  <li>Default values</li>
  <li>Unit lists for numeric questions</li>
  <li>Date fields</li>
  <li>Help messages for questions</li>
  <li><a href="#fhirSupport">Support</a> for HL7 <a
   href="https://www.hl7.org/fhir/"></a>FHIR Questionnaires</a>
</ul>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Installation</h2>

<p>LHC-Forms can be used either as a prebuilt package or installed using the using the
<a href="http://bower.io">bower</a> package manager (i.e. <code>bower
install lforms</code>).  If you aren't using bower, the simplest way to start
using LHC-Forms is by linking to the prebuilt version hosted on
clinicaltables.nlm.nih.gov.  The
URLs for the JavaScript and the CSS are:
</p>
<dl>
  <dt>JavaScript</dt><dd>https://clinicaltables.nlm.nih.gov/lforms-versions/13.6.0/lforms.min.js</dd>
  <dt>CSS</dt><dd>https://clinicaltables.nlm.nih.gov/lforms-versions/13.6.0/styles/lforms.min.css</dd>
</dl>

<p>(Note that the URLs contain a release version number, 13.6.0, for which you
can substitute any of the other prebuilt versions available at
https://clinicaltables.nlm.nih.gov/lforms-versions).</p>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Usage</h2>

<p>Although LHC-Forms internally uses AngularJS and offers a directive for use by
AngularJS projects, you do not need to know anything about AngularJS to use
it.</p>

<h3>Rendering a Form (Without AngularJS)</h3>
<p>In your HTML, create a an element to hold the form.  You will pass a
reference to this element or its ID to a utility function load the form.</p>

<h4>HTML (without AngularJS)</h4>
<pre><code>&lt;div id="myFormContainer"&gt;&lt;/div&gt;
</code></pre>

<p>Also include the LHC-Forms JavaScript and CSS files on the page.  In your page
header:</p>

<pre><code>
&lt;link
 href="https://clinicaltables.nlm.nih.gov/lforms-versions/13.6.0/styles/lforms.min.css"
 media="screen" rel="stylesheet" /&gt;
</code></pre>

And with your other JavaScript:

<pre><code>&lt;script
 src="https://clinicaltables.nlm.nih.gov/lforms-versions/13.6.0/lforms.min.js"
 &gt;&lt;/script&gt;
</code></pre>

<h4>JavaScript (without AngularJS)</h4>

<pre><code>LForms.Util.addFormToPage(formDefinition, 'myFormContainer');
</code></pre>

Parameters:
<ol>
  <li>formDefinition - A <a href="#formdef">form definition</a> (either JSON or
   a parsed object)</li>
  <li>formContainer - An element (or its ID, as in this example) into which the
   form should be placed</li>
</ol>

<h3>Rendering a Form (AngularJS Method)</h3>

<p>As in the non-Angular method, you will need to include the LHC-Forms CSS and
JavaScript (possibly using bower and wiredep, if you are using those).</p>

<h4>
<a id="html" class="anchor" href="#html" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>HTML</h3>

<p>The HTML in your page will look something like:</p>

<pre><code>&lt;body ng-app="myApp"&gt;
  &lt;div ng-controller="myController"&gt;
    &lt;lforms lf-data="myFormDefinition"&gt;&lt;/lforms&gt;
  &lt;/div&gt;
&lt;/body&gt;
</code></pre>

<p>The directive is contained by a controller (in this example named
"myController") which will have the responsibility of providing the
form definition data as a JSON object (in this example named "myFormDefinition").</p>

<h4>
<a id="javascript" class="anchor" href="#javascript" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>JavaScript</h3>

<p>In the JavaScript for the AngularJS app, include 'lformsWidget' as a module to
be loaded. Then, in the JavaScript for the AngularJS controller, construct an
LFormsData object with the JSON <a href="#formdef">form definition</a> and assign that
object to the scope variable "lfData".  The form should initialize and display.
For example:</p>

<pre><code>angular.module('myApp', ['lformsWidget'])
  .controller('myController', ['$scope', function ($scope) {
    $scope.myFormData = new LForms.LFormsData(myFormDefinition);
  }]);
</code></pre>

<h3>
<a id="retrieving-user-entered-data" class="anchor" href="#retrieving-user-entered-data" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Retrieving User-Entered Data</h3>

<p>After the user fills out a form, the data they have entered and things like
codes for coded answer lists will be stored in the data model.  To retrieve that
data, LHC-Forms provides the following utility method:</p>

<pre><code>LForms.Util.getUserData(formElement, noFormDefData, noEmptyValue, noHiddenItem)
</code></pre>

Or, from wihin an AngularJS app, there is also an API on the LFormsData object:</p>

<pre><code>$scope.myFormData.getUserData(noFormDefData, noEmptyValue, noHiddenItem)
</code></pre>

<p>With no arguments (i.e. LForms.Util.getUserData()), the data for the first LForm
found on that page will be returned, and will include the form definition,
along with entries for questions the user left blank and for questions that were
hidden by skip-logic (which the user might not have seen).  This default return
behavior can be changed by the parameters, but in all cases the returned data
will follow the structure of the form, in that answers will be nested inside
containing sections.</p>

<p>The parameters are:</p>

<ol>
<li>formElement - an HTML element that includes the LForm's rendered form. If
this is omitted, the "body" tag will be used.  If there is more than one
LForm within formElement, the first found will be used.</li>
<li>noFormDefData (optional, default false) - If this is true, the form
definition data will not be returned along with the data.</li>
<li>noEmptyValue (optional, default false) - If this is true, items that have
an empty value will be removed.</li>
<li>noHiddenItem (optional, default false) - If this is true, items that are
hidden by skip logic will be removed.</li>
</ol>

<p>As an example, here is the data from a partially filled-in vital signs panel,
returned via <code>$scope.myFormData.getUserData(null, true, true, true)</code>:</p>

<div class="highlight highlight-source-json"><pre>    {
      <span class="pl-s"><span class="pl-pds">"</span>itemsData<span class="pl-pds">"</span></span>: [{
        <span class="pl-s"><span class="pl-pds">"</span>questionCode<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>35094-2<span class="pl-pds">"</span></span>,
        <span class="pl-s"><span class="pl-pds">"</span>items<span class="pl-pds">"</span></span>: [{
          <span class="pl-s"><span class="pl-pds">"</span>questionCode<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>8480-6<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>value<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>100<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>unit<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>mm[Hg]<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>default<span class="pl-pds">"</span></span>: <span class="pl-c1">false</span>,
            <span class="pl-s"><span class="pl-pds">"</span>normalRange<span class="pl-pds">"</span></span>: <span class="pl-c1">null</span>,
            <span class="pl-s"><span class="pl-pds">"</span>absoluteRange<span class="pl-pds">"</span></span>: <span class="pl-c1">null</span>
          }
        }, {
          <span class="pl-s"><span class="pl-pds">"</span>questionCode<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>8357-6<span class="pl-pds">"</span></span>,
          <span class="pl-s"><span class="pl-pds">"</span>value<span class="pl-pds">"</span></span>: {
            <span class="pl-s"><span class="pl-pds">"</span>label<span class="pl-pds">"</span></span>: <span class="pl-c1">null</span>,
            <span class="pl-s"><span class="pl-pds">"</span>code<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>LA24014-5<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>text<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>Oscillometry<span class="pl-pds">"</span></span>,
            <span class="pl-s"><span class="pl-pds">"</span>other<span class="pl-pds">"</span></span>: <span class="pl-c1">null</span>
          }
        }]
      }],
      <span class="pl-s"><span class="pl-pds">"</span>templateData<span class="pl-pds">"</span></span>: [{
        <span class="pl-s"><span class="pl-pds">"</span>value<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>2015-11-09T05:00:00.000Z<span class="pl-pds">"</span></span>
      }]
    }</pre></div>

<p>The first section in the returned data "itemsData" contains all of the data from
the form itself.  LHC-Forms (optionally) adds a section to the top of the form that
includes fields like "Date" and "Comment", and the data for these elements shows
up in "templateData".  The form definition data was not included in the above
example, but you can see the structure if you look closely at itemsData.  In
this form, there was a section (question code "35094-2") which contained both of
the two filled-in items as data.  That is why there is just one entry in the
itemsData itself, and that item has two sub-items in "items" array.  One of the
two items was numeric and had an associated unit field, while the other was a
coded list field.</p>

<p>Another utility method, LForms.Util.getFormData(), will return both the user
data and form definition data together in a way that can be fed back to LHC-Forms
to display the form with the data.  This is useful when you want to allow the
user to save the form so it can be redisplayed later for completion or editing.</p>


  <h3>
    <a id="retrieving-hl7-data" class="anchor" href="#retrieving-hl7-data" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>
    Retrieving User-Entered Data as HL7 v2 OBR and OBX segments (version >= 12.8)
  </h3>
  <p>The user entered data, along with some form definition data can be retrieved as HL7 v2 OBR and OBX segments.
    To retrieve that data, LHC-Forms provides the following utility method:</p>
  <pre>
    <code>LForms.Util.getFormHL7Data(element)</code></pre>

  <p>The parameter is:</p>
  <ol>
    <li>element - (optional if there is only one LHC-Forms widget on the page.)  The containing HTML element that includes
      the LHC-Forms rendered form. It could be the DOM element or its id.</li>
  </ol>


  <h2><a id="fhirSupport"></a>Support for FHIR Questionnaire Resources</h2>
  <p>LHC-Forms can import and export <a href="https://www.hl7.org/fhir/">FHIR</a>
   Questionnaire and QuestionnaireResponse
   resources.  Also, there is partial support for importing and exporting
   DiagnosticReports (but those need to be generated by LHC-Forms).</p>

  <h3>Files for FHIR Support</h3>
  <p>Because adding support for FHIR (and multiple versions of FHIR) would
  increase the size of the LHC-Forms library, support for FHIR is added through
  separate files.  If you are using one of the prebuilt versions, you can
  include:
<pre><code>&lt;script src="https://clinicaltables.nlm.nih.gov/lforms-versions/13.6.0/fhir/R4/lformsFHIR.min.js"&gt;&lt;/script&gt;</code></pre>
  for FHIR version "R4", or for version "STU3", replace the "R4" in the URL with
  "STU3".  It is safe to include both versions if your application needs
  both.</p>
  <p>If you are installing via bower, the additional files to include are:</p>
  <ul>
    <li>For version R4:
     bower_components/lforms/app/scripts/fhir/R4/lformsFHIR.js</li>
    <li>For version STU3:
     bower_components/lforms/app/scripts/fhir/STU3/lformsFHIR.js</li>
  </ul>
  <p>As with the prebuilt files, you may include either the R4 or the STU3 version,
   or both.</p>

  <h3>
    <a id="retrieving-fhir-data" class="anchor" href="#retrieving-fhir-data" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>
    Exporting FHIR Resources
  </h3>
  <p>The form definiton and user-entered data can be
    retrieved as <a href="https://www.hl7.org/fhir/">FHIR</a> resources, using
    the following utility method:</p>
  <pre>
    <code>LForms.Util.getFormFHIRData(resourceType, fhirVersion, formDataSource, options)</code></pre>

  <p>The parameters are:</p>
  <ol>
    <li>resourceType - a FHIR resource type. Currently only "DiagnosticReport",
      "Questionnaire" (SDC profile) and "QuestionnaireResponse" (SDC profile)
      are supported as parameter values.</li>
    <li>fhirVersion - the version of FHIR being used.  This can be set to either
     "STU3" or "R4".</li>
    <li>formDataSource - Optional.  Either the containing HTML element that
      includes the rendered form, a CSS selector for that element, an
      LFormsData object, or an LHC-Forms form definition (parsed).  If not
      provided, the first LHC-Forms form found in the page will be used.</li>
    <li>options - An optional hash of other options, with the following optional keys:
      <ul>
        <li>bundleType - optional, and only used for DiagnosticReport output.
          This may be either "transaction" or "collection", and requests
          that the DiagnosticReport and associated Observation resources be placed
          together in a bundle of that type.  When this is not present, a bundle
          will not be used.</li>
        <li>noExtensions - a flag that a standard FHIR Questionnaire or QuestionnaireResponse is to be created
          without any extensions, when resourceType is Questionnaire or QuestionnaireResponse.
          The default is false.</li>
        <li>subject: A local FHIR resource that is the subject of the output
          resource.  If provided, a reference to this resource
          will be added to the output FHIR resource when applicable.</li>
      </ul>
    </li>
  </ol>

  <h3>
    <a id="convert-fhir-data" class="anchor" href="#convert-fhir-data" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>
    Converting a FHIR Questionnaire Resource to the LHC-Forms Format
  </h3>
  <p>FHIR Questionnaire resource can be converted/imported into the LHC-Forms format,
    which can then be loaded into the LHC-Forms widget to show the form.  To do
    that conversion, LHC-Forms provides the following
    utility method:</p>
  <pre>
    <code>LForms.Util.convertFHIRQuestionnaireToLForms(fhirData, fhirVersion)</code></pre>

  <p>The parameters are:</p>
  <ol>
    <li>fhirData - a FHIR Questionnaire resource (parsed).  Note that our support for
      Questionnaire is incomplete but in progress.  If you run into a problem,
      please open an issue on the <a href="https://github.com/lhncbc/lforms"
      >LForms</a> repository.</li>
    <li>fhirVersion - the version of FHIR in which the Questionnaire is
     written (currently takes either "STU3" or "R4").  This maybe be omitted if
     the Questionnaire resource (in fhirData) conains a <a href=
     "http://build.fhir.org/versioning.html#mp-version">meta.profile</a>
     attibute specifying the FHIR version.  If both are provided, this takes
     precedence.</li>
  </ol>

  <p>The return value is a form definition in the <a
   href="https://github.com/lhncbc/lforms">LHC-Forms format</a>.</p>

  <h3>
    <a id="merge-fhir-data" class="anchor" href="#merge-fhir-data" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>
    Merging FHIR Resources into an LHC-Forms Form
  </h3>
  <p>FHIR DiagnosticReports (if generated by LHC-Forms) and FHIR QuestionnaireResponses
   can be loaded into an LHC-Forms form definition to produce a structure that can be
   loaded into the LHC-Forms widget (using the same methods as for JSON form
   defintions described above) to show the form along with the user data.
   To merge FHIR resources into LHC-Forms data, LHC-Forms provides the following utility method:</p>
  <pre>
    <code>LForms.Util.mergeFHIRDataIntoLForms(resourceType, fhirData, formData, fhirVersion)</code></pre>

  <p>The parameters are:</p>
  <ol>
    <li>resourceType - a FHIR resource type. Currently only
      "QuestionnaireResponse" (SDC profile) and "DiagnosticReport" (either a
      DiagnosticReport resource with "contained" Observation resources or a
      "searchset" typed Bundle of a DiagnosticReport and associated Observation
      resources) are supported.</li>
    <li>fhirData - a FHIR resource of the type specified in the resourceType
     parameter.  Note that for DiagnosticReports, the merge will only
     work if the DiagnosticReport was originally generated by LHC-Forms.</li>
    <li>formData - an LHC-Forms form definition or data object.</li>
    <li>fhirVersion - the version of FHIR in which the resource is
     written (currently takes either "STU3" or "R4").  This maybe be omitted if
     the resource (in fhirData) conains a <a href=
     "http://build.fhir.org/versioning.html#mp-version">meta.profile</a>
     attibute specifying the FHIR version.  If both are provided, this takes
     precedence.</li>
  </ol>

  <p>The return value is a form definition object but with the user data merged
   into it.  It can be displayed using LForms.Util.addFormToPage described above.</p>

  <h2>
<a id="form-definition-format" class="anchor" href="#form-definition-format" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a><a name="formdef"></a>Form Definition Format</h2>

<p>Form definitions are stored in a JSON structure.  To get a rough idea of what
these are you can take a look at one of the
<a href="https://github.com/lhncbc/lforms/blob/master/app/data/sample-data.js">samples</a>, or for a detailed description see the
<a href="https://github.com/lhncbc/lforms/blob/master/form_definition.md">form definition documentation</a>.</p>

<h2>
<a id="licensing-and-copyright-notice" class="anchor" href="#licensing-and-copyright-notice" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Licensing and Copyright Notice</h2>
<p>See the <a href="https://github.com/lhncbc/lforms/blob/master/LICENSE.md"
  >LICENSE.md</a> file in the lforms package on GitHub.</p>

<hr>

    <span class="credits left">Project maintained by <a href="https://github.com/lhncbc">lhncbc</a></span>
    <span class="credits right">Hosted on GitHub Pages &mdash; Based on theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
      </section>

    </div>


    <!--[if !IE]><script>fixScale(document);</script><![endif]-->

  </body>
</html>
